{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport axios, { formToJSON } from 'axios';\nimport { Form } from 'react-router-dom';\nconst user = JSON.parse(localStorage.getItem('token'));\nconst API = axios.create({\n  baseURL: `${process.env.REACT_APP_BASE_API_URL}/posts`\n});\nAPI.interceptors.request.use(request => {\n  if (user) {\n    request.headers.Authorization = `Bearer ${user}`;\n  }\n  return request;\n});\nexport const getAllPosts = createAsyncThunk('post/get', async () => {\n  try {\n    const {\n      data\n    } = await API.get('/all');\n    if (data) {\n      return data;\n    }\n  } catch (err) {\n    return null;\n  }\n});\nexport const createPost = createAsyncThunk('post/create', async _ref => {\n  let {\n    postForm,\n    setPostForm\n  } = _ref;\n  try {\n    const formData = new FormData();\n    formData.append('title', postForm.title);\n    formData.append('description', postForm.description);\n    formData.append('image', postForm.image);\n    formData.append('user_id', postForm.user_id);\n    const {\n      data\n    } = await API.post('/create', formData);\n    if (data) {\n      setPostForm({\n        title: \"\",\n        image: \"\",\n        description: \"\"\n      });\n      window.location.href = \"/\";\n      return data;\n    }\n  } catch (err) {\n    return null;\n  }\n});\nconst PostSlice = createSlice({\n  name: 'post',\n  initialState: {\n    posts: [],\n    loading: false\n  },\n  extraReducers: builder => {\n    builder.addCase(getAllPosts.fulfilled, (state, _ref2) => {\n      let {\n        payload\n      } = _ref2;\n      state.posts = payload;\n      return state;\n    });\n  }\n});\nexport default PostSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","formToJSON","Form","user","JSON","parse","localStorage","getItem","API","create","baseURL","process","env","REACT_APP_BASE_API_URL","interceptors","request","use","headers","Authorization","getAllPosts","data","get","err","createPost","postForm","setPostForm","formData","FormData","append","title","description","image","user_id","post","window","location","href","PostSlice","name","initialState","posts","loading","extraReducers","builder","addCase","fulfilled","state","payload","reducer"],"sources":["D:/programmer/project-pl/inspobox/frontend/src/slices/PostSlice.js"],"sourcesContent":["import { createSlice,createAsyncThunk } from '@reduxjs/toolkit';\r\nimport axios, { formToJSON } from 'axios';\r\nimport { Form } from 'react-router-dom';\r\n\r\nconst user = JSON.parse(localStorage.getItem('token'));\r\n\r\nconst API = axios.create({\r\n    baseURL:`${process.env.REACT_APP_BASE_API_URL}/posts`\r\n});\r\n\r\nAPI.interceptors.request.use(request => {\r\n    if(user){\r\n        request.headers.Authorization = `Bearer ${user}`;\r\n    }\r\n\r\n    return request;\r\n});\r\n\r\nexport const getAllPosts = createAsyncThunk('post/get' , async () => {\r\n     try {\r\n        const { data } = await API.get('/all');\r\n        if(data) {\r\n            return data;\r\n        }\r\n\r\n     } catch(err) {\r\n        return null;\r\n     }\r\n});\r\n\r\nexport const createPost = createAsyncThunk('post/create' , async ({ postForm,setPostForm }) => {\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title' , postForm.title);\r\n        formData.append('description',postForm.description);\r\n        formData.append('image' , postForm.image);\r\n        formData.append('user_id' , postForm.user_id);\r\n\r\n        const { data } = await API.post('/create' , formData);\r\n\r\n        if(data) {\r\n        setPostForm({\r\n          title:\"\",\r\n          image:\"\",\r\n          description:\"\"\r\n       });\r\n\r\n            window.location.href = \"/\";\r\n\r\n            return data;\r\n        }\r\n\r\n    } catch(err) {\r\n        return null;\r\n    }\r\n});\r\n\r\nconst PostSlice = createSlice({\r\n    name:'post',\r\n    initialState: {\r\n        posts:[],\r\n        loading:false \r\n    },\r\n    extraReducers:(builder) => {\r\n        builder.addCase(getAllPosts.fulfilled,(state, { payload }) => {\r\n            state.posts = payload;\r\n\r\n            return state;\r\n        })\r\n    }\r\n});\r\n\r\nexport default PostSlice.reducer;"],"mappings":"AAAA,SAASA,WAAW,EAACC,gBAAgB,QAAQ,kBAAkB;AAC/D,OAAOC,KAAK,IAAIC,UAAU,QAAQ,OAAO;AACzC,SAASC,IAAI,QAAQ,kBAAkB;AAEvC,MAAMC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAAC;AAEtD,MAAMC,GAAG,GAAGR,KAAK,CAACS,MAAM,CAAC;EACrBC,OAAO,EAAE,GAAEC,OAAO,CAACC,GAAG,CAACC,sBAAuB;AAClD,CAAC,CAAC;AAEFL,GAAG,CAACM,YAAY,CAACC,OAAO,CAACC,GAAG,CAACD,OAAO,IAAI;EACpC,IAAGZ,IAAI,EAAC;IACJY,OAAO,CAACE,OAAO,CAACC,aAAa,GAAI,UAASf,IAAK,EAAC;EACpD;EAEA,OAAOY,OAAO;AAClB,CAAC,CAAC;AAEF,OAAO,MAAMI,WAAW,GAAGpB,gBAAgB,CAAC,UAAU,EAAG,YAAY;EAChE,IAAI;IACD,MAAM;MAAEqB;IAAK,CAAC,GAAG,MAAMZ,GAAG,CAACa,GAAG,CAAC,MAAM,CAAC;IACtC,IAAGD,IAAI,EAAE;MACL,OAAOA,IAAI;IACf;EAEH,CAAC,CAAC,OAAME,GAAG,EAAE;IACV,OAAO,IAAI;EACd;AACL,CAAC,CAAC;AAEF,OAAO,MAAMC,UAAU,GAAGxB,gBAAgB,CAAC,aAAa,EAAG,cAAoC;EAAA,IAA7B;IAAEyB,QAAQ;IAACC;EAAY,CAAC;EACtF,IAAI;IACA,MAAMC,QAAQ,GAAG,IAAIC,QAAQ,EAAE;IAC/BD,QAAQ,CAACE,MAAM,CAAC,OAAO,EAAGJ,QAAQ,CAACK,KAAK,CAAC;IACzCH,QAAQ,CAACE,MAAM,CAAC,aAAa,EAACJ,QAAQ,CAACM,WAAW,CAAC;IACnDJ,QAAQ,CAACE,MAAM,CAAC,OAAO,EAAGJ,QAAQ,CAACO,KAAK,CAAC;IACzCL,QAAQ,CAACE,MAAM,CAAC,SAAS,EAAGJ,QAAQ,CAACQ,OAAO,CAAC;IAE7C,MAAM;MAAEZ;IAAK,CAAC,GAAG,MAAMZ,GAAG,CAACyB,IAAI,CAAC,SAAS,EAAGP,QAAQ,CAAC;IAErD,IAAGN,IAAI,EAAE;MACTK,WAAW,CAAC;QACVI,KAAK,EAAC,EAAE;QACRE,KAAK,EAAC,EAAE;QACRD,WAAW,EAAC;MACf,CAAC,CAAC;MAEGI,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,GAAG;MAE1B,OAAOhB,IAAI;IACf;EAEJ,CAAC,CAAC,OAAME,GAAG,EAAE;IACT,OAAO,IAAI;EACf;AACJ,CAAC,CAAC;AAEF,MAAMe,SAAS,GAAGvC,WAAW,CAAC;EAC1BwC,IAAI,EAAC,MAAM;EACXC,YAAY,EAAE;IACVC,KAAK,EAAC,EAAE;IACRC,OAAO,EAAC;EACZ,CAAC;EACDC,aAAa,EAAEC,OAAO,IAAK;IACvBA,OAAO,CAACC,OAAO,CAACzB,WAAW,CAAC0B,SAAS,EAAC,CAACC,KAAK,YAAkB;MAAA,IAAhB;QAAEC;MAAQ,CAAC;MACrDD,KAAK,CAACN,KAAK,GAAGO,OAAO;MAErB,OAAOD,KAAK;IAChB,CAAC,CAAC;EACN;AACJ,CAAC,CAAC;AAEF,eAAeT,SAAS,CAACW,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}